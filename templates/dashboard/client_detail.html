{% extends "base.html" %}
{% block content %}
<div class="flex items-center gap-3 mb-6">
    <a href="/clients" class="text-gray-400 hover:text-gray-600"><i class="fa-solid fa-arrow-left"></i></a>
    <h2 class="text-xl sm:text-2xl font-bold" id="client-title"><i class="fa-solid fa-user text-indigo-600 mr-2"></i>Client Details</h2>
</div>

<!-- Client Info -->
<div class="bg-white rounded-xl shadow-sm p-4 sm:p-6 mb-6">
    <div id="client-info" class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <div class="bg-gray-50 p-4 rounded-lg"><p class="text-gray-500 text-xs">Name</p><p class="font-semibold" id="cd-name">-</p></div>
        <div class="bg-gray-50 p-4 rounded-lg"><p class="text-gray-500 text-xs">Company</p><p class="font-semibold" id="cd-company">-</p></div>
        <div class="bg-gray-50 p-4 rounded-lg"><p class="text-gray-500 text-xs">Email</p><p class="font-semibold" id="cd-email">-</p></div>
        <div class="bg-gray-50 p-4 rounded-lg"><p class="text-gray-500 text-xs">Accounts</p><p class="font-semibold" id="cd-accounts">0</p></div>
    </div>
</div>

<!-- Sub-tabs -->
<div class="flex gap-2 mb-6 flex-wrap">
    <button onclick="showClientTab('pipeline')" class="tab-btn active" id="tab-pipeline">Pipeline</button>
    <button onclick="showClientTab('calendar')" class="tab-btn" id="tab-calendar">Calendar</button>
    <button onclick="showClientTab('accounts')" class="tab-btn" id="tab-accounts">Accounts</button>
    <button onclick="showClientTab('rules')" class="tab-btn" id="tab-rules">Posting Rules</button>
</div>

<div id="client-tab-pipeline" class="tab-content active">
    <div class="kanban-board" id="client-pipeline-board"></div>
</div>
<div id="client-tab-calendar" class="tab-content">
    <div class="bg-white rounded-xl shadow-sm p-3 sm:p-6">
        <div class="flex items-center gap-2 mb-4">
            <button onclick="changeClientMonth(-1)" class="bg-gray-200 px-3 py-1 rounded-lg"><i class="fa-solid fa-chevron-left"></i></button>
            <span id="client-calendar-month" class="bg-white px-4 py-1 rounded-lg font-semibold text-sm"></span>
            <button onclick="changeClientMonth(1)" class="bg-gray-200 px-3 py-1 rounded-lg"><i class="fa-solid fa-chevron-right"></i></button>
        </div>
        <div class="grid grid-cols-7 gap-1 mb-2">
            <div class="text-center font-semibold text-gray-600 py-1 text-xs">Sun</div>
            <div class="text-center font-semibold text-gray-600 py-1 text-xs">Mon</div>
            <div class="text-center font-semibold text-gray-600 py-1 text-xs">Tue</div>
            <div class="text-center font-semibold text-gray-600 py-1 text-xs">Wed</div>
            <div class="text-center font-semibold text-gray-600 py-1 text-xs">Thu</div>
            <div class="text-center font-semibold text-gray-600 py-1 text-xs">Fri</div>
            <div class="text-center font-semibold text-gray-600 py-1 text-xs">Sat</div>
        </div>
        <div id="client-calendar-grid" class="grid grid-cols-7 gap-1"></div>
    </div>
</div>
<div id="client-tab-accounts" class="tab-content">
    <div id="client-accounts-list" class="space-y-2"></div>
    <button onclick="showAddAccountModal()" class="mt-4 bg-indigo-600 text-white px-4 py-2 rounded-lg text-sm"><i class="fa-solid fa-plus mr-1"></i> Link Account</button>
</div>
<div id="client-tab-rules" class="tab-content">
    <div id="client-rules-content"></div>
</div>
{% endblock %}

{% block modals %}
<div id="add-account-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50 p-4" onclick="if(event.target===this) hideAddAccountModal()">
    <div class="bg-white rounded-xl p-6 w-full sm:w-[450px] max-w-lg max-h-[90vh] overflow-y-auto shadow-2xl">
        <h3 class="text-lg font-bold mb-4">Link New Account</h3>
        <div class="mb-4"><label class="block text-gray-700 mb-2 text-sm">Platform *</label>
            <select id="account-platform" class="w-full border rounded-lg px-4 py-3 text-sm" onchange="updateAccountFields()">
                <option value="">Select Platform</option><option value="instagram">Instagram</option><option value="linkedin">LinkedIn</option><option value="facebook">Facebook</option>
            </select>
        </div>
        <div class="mb-4"><label class="block text-gray-700 mb-2 text-sm">Account Name</label><input type="text" id="account-name" class="w-full border rounded-lg px-4 py-3 text-sm"></div>
        <div class="mb-4" id="account-token-field"><label class="block text-gray-700 mb-2 text-sm">Access Token *</label><textarea id="account-token" class="w-full border rounded-lg px-4 py-3 h-20 text-xs"></textarea></div>
        <div class="mb-4" id="account-id-field"><label class="block text-gray-700 mb-2 text-sm">Account ID / Page ID</label><input type="text" id="account-id" class="w-full border rounded-lg px-4 py-3"></div>
        <div class="bg-blue-50 p-3 rounded-lg mb-4 text-sm" id="platform-help">Select a platform first</div>
        <div class="flex gap-4">
            <button onclick="saveAccount()" class="flex-1 bg-indigo-600 text-white px-4 py-2 rounded-lg">Link Account</button>
            <button onclick="hideAddAccountModal()" class="flex-1 bg-gray-200 px-4 py-2 rounded-lg">Cancel</button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
const clientId = {{ client_id }};
</script>
<script src="/static/js/client-detail.js"></script>
{% endblock %}
