{% extends "base.html" %}
{% block content %}
<div class="flex items-center gap-3 mb-6">
    <a href="/clients" class="text-gray-400 hover:text-gray-600"><i class="fa-solid fa-arrow-left"></i></a>
    <h2 class="text-xl sm:text-2xl font-bold" id="client-title"><i class="fa-solid fa-user text-indigo-600 mr-2"></i>Client Details</h2>
</div>

<!-- Client Info -->
<div class="bg-white rounded-xl shadow-sm p-4 sm:p-6 mb-6">
    <div id="client-info" class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <div class="bg-gray-50 p-4 rounded-lg"><p class="text-gray-500 text-xs">Name</p><p class="font-semibold" id="cd-name">-</p></div>
        <div class="bg-gray-50 p-4 rounded-lg"><p class="text-gray-500 text-xs">Company</p><p class="font-semibold" id="cd-company">-</p></div>
        <div class="bg-gray-50 p-4 rounded-lg"><p class="text-gray-500 text-xs">Email</p><p class="font-semibold" id="cd-email">-</p></div>
        <div class="bg-gray-50 p-4 rounded-lg"><p class="text-gray-500 text-xs">Accounts</p><p class="font-semibold" id="cd-accounts">0</p></div>
    </div>
</div>

<!-- Team Assignments -->
<div class="bg-white rounded-xl shadow-sm p-4 sm:p-6 mb-6">
    <h3 class="font-semibold text-sm mb-3 flex items-center gap-2"><i class="fa-solid fa-users text-indigo-600"></i> Team Assignments</h3>
    <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-3" id="client-assignments-grid">
        <div>
            <label class="block text-xs text-gray-500 mb-1"><i class="fa-solid fa-user-tie text-green-500 mr-1"></i>Manager</label>
            <select id="ca-manager" class="w-full border rounded-lg px-3 py-2 text-sm"><option value="">-- None --</option></select>
        </div>
        <div>
            <label class="block text-xs text-gray-500 mb-1"><i class="fa-solid fa-pen-nib text-yellow-500 mr-1"></i>Copywriter</label>
            <select id="ca-writer" class="w-full border rounded-lg px-3 py-2 text-sm"><option value="">-- None --</option></select>
        </div>
        <div>
            <label class="block text-xs text-gray-500 mb-1"><i class="fa-solid fa-paintbrush text-purple-500 mr-1"></i>Designer</label>
            <select id="ca-designer" class="w-full border rounded-lg px-3 py-2 text-sm"><option value="">-- None --</option></select>
        </div>
        <div>
            <label class="block text-xs text-gray-500 mb-1"><i class="fa-solid fa-bullhorn text-blue-500 mr-1"></i>SM Specialist</label>
            <select id="ca-sm" class="w-full border rounded-lg px-3 py-2 text-sm"><option value="">-- None --</option></select>
        </div>
        <div>
            <label class="block text-xs text-gray-500 mb-1"><i class="fa-solid fa-film text-red-500 mr-1"></i>Motion Editor</label>
            <select id="ca-motion" class="w-full border rounded-lg px-3 py-2 text-sm"><option value="">-- None --</option></select>
        </div>
    </div>
    <button onclick="saveClientAssignments()" class="mt-3 bg-indigo-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-indigo-700 transition">
        <i class="fa-solid fa-save mr-1"></i> Save Assignments
    </button>
</div>

<!-- Sub-tabs -->
<div class="flex gap-2 mb-6 flex-wrap">
    <button onclick="showClientTab('pipeline')" class="tab-btn active" id="tab-pipeline">Pipeline</button>
    <button onclick="showClientTab('calendar')" class="tab-btn" id="tab-calendar">Calendar</button>
    <button onclick="showClientTab('accounts')" class="tab-btn" id="tab-accounts">Accounts</button>
    <button onclick="showClientTab('rules')" class="tab-btn" id="tab-rules">Posting Rules</button>
</div>

<div id="client-tab-pipeline" class="tab-content active">
    <div class="kanban-board" id="client-pipeline-board"></div>
</div>
<div id="client-tab-calendar" class="tab-content">
    <div class="bg-white rounded-xl shadow-sm p-3 sm:p-6">
        <div class="flex flex-wrap items-center gap-2 mb-3">
            <select id="client-cal-status-filter" onchange="applyClientStatusFilter()" class="border rounded-lg px-3 py-1 text-sm">
                <option value="">All Statuses</option>
                <option value="Needs Design">Needs Design</option>
                <option value="Needs Caption">Needs Caption</option>
                <option value="Design Review">Design Review</option>
                <option value="Ready">Ready</option>
                <option value="Scheduled">Scheduled</option>
                <option value="Posted">Posted</option>
            </select>
            <button onclick="changeClientMonth(-1)" class="bg-gray-200 px-3 py-1 rounded-lg"><i class="fa-solid fa-chevron-left"></i></button>
            <span id="client-calendar-month" class="bg-white px-4 py-1 rounded-lg font-semibold text-sm"></span>
            <button onclick="changeClientMonth(1)" class="bg-gray-200 px-3 py-1 rounded-lg"><i class="fa-solid fa-chevron-right"></i></button>
        </div>
        <!-- Status legend -->
        <div class="cal-status-legend mb-3">
            <span class="legend-item"><span class="legend-dot" style="background:#f97316"></span> Needs Design</span>
            <span class="legend-item"><span class="legend-dot" style="background:#eab308"></span> Needs Caption</span>
            <span class="legend-item"><span class="legend-dot" style="background:#8b5cf6"></span> Design Review</span>
            <span class="legend-item"><span class="legend-dot" style="background:#22c55e"></span> Ready</span>
            <span class="legend-item"><span class="legend-dot" style="background:#3b82f6"></span> Scheduled</span>
            <span class="legend-item"><span class="legend-dot" style="background:#10b981"></span> Posted</span>
        </div>
        <div class="grid grid-cols-7 gap-1 mb-2">
            <div class="text-center font-semibold text-gray-600 py-1 text-xs">Sun</div>
            <div class="text-center font-semibold text-gray-600 py-1 text-xs">Mon</div>
            <div class="text-center font-semibold text-gray-600 py-1 text-xs">Tue</div>
            <div class="text-center font-semibold text-gray-600 py-1 text-xs">Wed</div>
            <div class="text-center font-semibold text-gray-600 py-1 text-xs">Thu</div>
            <div class="text-center font-semibold text-gray-600 py-1 text-xs">Fri</div>
            <div class="text-center font-semibold text-gray-600 py-1 text-xs">Sat</div>
        </div>
        <div id="client-calendar-grid" class="grid grid-cols-7 gap-1"></div>
    </div>
    <input type="file" id="client-cal-file-input" multiple accept="image/*,video/*" class="hidden">
</div>
<div id="client-tab-accounts" class="tab-content">
    <div id="client-accounts-list" class="space-y-2"></div>
    <button onclick="showAddAccountModal()" class="mt-4 bg-indigo-600 text-white px-4 py-2 rounded-lg text-sm"><i class="fa-solid fa-plus mr-1"></i> Link Account</button>
</div>
<div id="client-tab-rules" class="tab-content">
    <div id="client-rules-content"></div>
</div>
{% endblock %}

{% block modals %}
<!-- Day Posts Modal -->
<div id="client-day-posts-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50" onclick="if(event.target===this) hideClientDayPostsModal()">
    <div class="bg-white rounded-xl p-6 w-[95%] sm:w-[600px] max-w-2xl max-h-[80vh] overflow-y-auto shadow-2xl">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-bold" id="client-day-posts-title">Posts</h3>
            <button onclick="hideClientDayPostsModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
        </div>
        <div id="client-day-posts-list" class="space-y-3"></div>
    </div>
</div>

<!-- Post Detail Modal -->
<div id="client-post-detail-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50" onclick="if(event.target===this) closeClientPostDetail()">
    <div class="bg-white rounded-xl p-6 w-[95%] sm:w-[700px] max-w-3xl max-h-[90vh] overflow-y-auto shadow-2xl">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-bold" id="client-detail-title">Post Brief</h3>
            <button onclick="closeClientPostDetail()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
        </div>
        <div class="flex flex-wrap gap-2 mb-4" id="client-detail-meta"></div>
        <div class="brief-section" id="client-detail-topic-section">
            <div class="brief-section-title"><i class="fa-solid fa-pen-fancy mr-1"></i> Text on Design</div>
            <div class="brief-section-content" id="client-detail-topic"></div>
        </div>
        <div class="brief-section" id="client-detail-notes-section">
            <div class="brief-section-title"><i class="fa-solid fa-paintbrush mr-1"></i> Notes for Designer</div>
            <div class="brief-section-content" id="client-detail-notes"></div>
        </div>
        <div class="brief-section" id="client-detail-references-section">
            <div class="brief-section-title"><i class="fa-solid fa-images mr-1"></i> Design References</div>
            <div class="design-gallery" id="client-detail-references"></div>
        </div>
        <div class="brief-section" id="client-detail-designs-section">
            <div class="brief-section-title"><i class="fa-solid fa-palette mr-1"></i> Design Output</div>
            <div class="design-gallery mb-2" id="client-detail-designs"></div>
            <div class="upload-zone p-4 rounded-lg text-center cursor-pointer text-sm text-gray-500" id="client-detail-upload-zone"
                 onclick="document.getElementById('client-detail-design-input').click()"
                 ondragover="event.preventDefault(); this.classList.add('dragover')"
                 ondragleave="this.classList.remove('dragover')"
                 ondrop="handleClientDetailDesignDrop(event)">
                <i class="fa-solid fa-cloud-arrow-up text-2xl mb-1 block text-indigo-400"></i>
                Drop designs here or click to upload
            </div>
            <input type="file" id="client-detail-design-input" multiple accept="image/*" class="hidden" onchange="uploadClientDetailDesign(this.files)">
        </div>
        <div class="brief-section">
            <div class="brief-section-title"><i class="fa-solid fa-message mr-1"></i> Caption</div>
            <textarea id="client-detail-caption" class="w-full border rounded-lg p-3 text-sm" rows="4" placeholder="Write caption..."></textarea>
            <button onclick="saveClientCaption()" class="mt-2 bg-indigo-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-indigo-700">
                <i class="fa-solid fa-save mr-1"></i> Save Caption
            </button>
        </div>
        <div class="brief-section" id="client-detail-tov-section">
            <div class="brief-section-title"><i class="fa-solid fa-bullhorn mr-1"></i> Tone of Voice</div>
            <div class="brief-section-content" id="client-detail-tov"></div>
        </div>
        <div class="brief-section" id="client-detail-assignments-section">
            <div class="brief-section-title"><i class="fa-solid fa-users mr-1"></i> Assignments</div>
            <div class="brief-section-content text-sm" id="client-detail-assignments"></div>
        </div>
        <div class="flex flex-wrap gap-2 mt-4" id="client-detail-actions"></div>
    </div>
</div>

<div id="add-account-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50 p-4" onclick="if(event.target===this) hideAddAccountModal()">
    <div class="bg-white rounded-xl p-6 w-full sm:w-[450px] max-w-lg max-h-[90vh] overflow-y-auto shadow-2xl">
        <h3 class="text-lg font-bold mb-4">Link New Account</h3>
        <div class="mb-4"><label class="block text-gray-700 mb-2 text-sm">Platform *</label>
            <select id="account-platform" class="w-full border rounded-lg px-4 py-3 text-sm" onchange="updateAccountFields()">
                <option value="">Select Platform</option><option value="instagram">Instagram</option><option value="linkedin">LinkedIn</option><option value="facebook">Facebook</option>
            </select>
        </div>
        <div class="mb-4"><label class="block text-gray-700 mb-2 text-sm">Account Name</label><input type="text" id="account-name" class="w-full border rounded-lg px-4 py-3 text-sm"></div>
        <div class="mb-4" id="account-token-field"><label class="block text-gray-700 mb-2 text-sm">Access Token *</label><textarea id="account-token" class="w-full border rounded-lg px-4 py-3 h-20 text-xs"></textarea></div>
        <div class="mb-4" id="account-id-field"><label class="block text-gray-700 mb-2 text-sm">Account ID / Page ID</label><input type="text" id="account-id" class="w-full border rounded-lg px-4 py-3"></div>
        <div class="bg-blue-50 p-3 rounded-lg mb-4 text-sm" id="platform-help">Select a platform first</div>
        <div class="flex gap-4">
            <button onclick="saveAccount()" class="flex-1 bg-indigo-600 text-white px-4 py-2 rounded-lg">Link Account</button>
            <button onclick="hideAddAccountModal()" class="flex-1 bg-gray-200 px-4 py-2 rounded-lg">Cancel</button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
const clientId = {{ client_id }};
</script>
<script src="/static/js/client-detail.js"></script>
{% endblock %}
