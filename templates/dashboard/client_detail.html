{% extends "base.html" %}
{% block content %}
<div class="flex items-center gap-3 mb-6">
    <a href="/clients" class="text-gray-400 hover:text-gray-600"><i class="fa-solid fa-arrow-left"></i></a>
    <h2 class="text-xl sm:text-2xl font-bold" id="client-title"><i class="fa-solid fa-building text-indigo-600 mr-2"></i>Account</h2>
</div>

<!-- Client Info -->
<div class="bg-white rounded-xl shadow-sm p-4 sm:p-6 mb-6">
    <div id="client-info" class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <div class="bg-gray-50 p-4 rounded-lg"><p class="text-gray-500 text-xs">Name</p><p class="font-semibold" id="cd-name">-</p></div>
        <div class="bg-gray-50 p-4 rounded-lg"><p class="text-gray-500 text-xs">Company</p><p class="font-semibold" id="cd-company">-</p></div>
        <div class="bg-gray-50 p-4 rounded-lg"><p class="text-gray-500 text-xs">Email</p><p class="font-semibold" id="cd-email">-</p></div>
        <div class="bg-gray-50 p-4 rounded-lg"><p class="text-gray-500 text-xs">Posts This Month</p><p class="font-semibold" id="cd-posts-count">0</p></div>
    </div>
    <!-- Brief & Content Requirements (visible to SMM and Designer roles) -->
    <div id="cd-brief-section" class="hidden mt-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="bg-indigo-50 border border-indigo-100 p-4 rounded-lg">
                <p class="text-indigo-600 text-xs font-semibold mb-1"><i class="fa-solid fa-file-lines mr-1"></i>Account Brief</p>
                <p class="text-sm text-gray-700 whitespace-pre-line" id="cd-brief-text">-</p>
            </div>
            <div class="bg-purple-50 border border-purple-100 p-4 rounded-lg">
                <p class="text-purple-600 text-xs font-semibold mb-2"><i class="fa-solid fa-list-check mr-1"></i>Content Requirements (per month)</p>
                <div id="cd-content-reqs" class="space-y-1 text-sm text-gray-700"></div>
            </div>
        </div>
    </div>
</div>

<!-- Calendar (main content) -->
<div class="bg-white rounded-xl shadow-sm p-3 sm:p-6">
    <div class="flex flex-wrap items-center gap-2 mb-3">
        <select id="client-cal-status-filter" onchange="applyClientStatusFilter()" class="border rounded-lg px-3 py-1 text-sm">
            <option value="">All Statuses</option>
            <option value="Draft">Draft</option>
            <option value="In Design">In Design</option>
            <option value="Design Review">Design Review</option>
            <option value="Approved">Approved</option>
            <option value="Scheduled">Scheduled</option>
            <option value="Posted">Posted</option>
        </select>
        <button onclick="changeClientMonth(-1)" class="bg-gray-200 px-3 py-1 rounded-lg"><i class="fa-solid fa-chevron-left"></i></button>
        <span id="client-calendar-month" class="bg-white px-4 py-1 rounded-lg font-semibold text-sm"></span>
        <button onclick="changeClientMonth(1)" class="bg-gray-200 px-3 py-1 rounded-lg"><i class="fa-solid fa-chevron-right"></i></button>
    </div>
    <!-- Status legend -->
    <div class="cal-status-legend mb-3">
        <span class="legend-item"><span class="legend-dot" style="background:#94a3b8"></span> Draft</span>
        <span class="legend-item"><span class="legend-dot" style="background:#f97316"></span> In Design</span>
        <span class="legend-item"><span class="legend-dot" style="background:#8b5cf6"></span> Design Review</span>
        <span class="legend-item"><span class="legend-dot" style="background:#22c55e"></span> Approved</span>
        <span class="legend-item"><span class="legend-dot" style="background:#3b82f6"></span> Scheduled</span>
        <span class="legend-item"><span class="legend-dot" style="background:#10b981"></span> Posted</span>
    </div>
    <div class="grid grid-cols-7 gap-1 mb-2">
        <div class="text-center font-semibold text-gray-600 py-1 text-xs">Sun</div>
        <div class="text-center font-semibold text-gray-600 py-1 text-xs">Mon</div>
        <div class="text-center font-semibold text-gray-600 py-1 text-xs">Tue</div>
        <div class="text-center font-semibold text-gray-600 py-1 text-xs">Wed</div>
        <div class="text-center font-semibold text-gray-600 py-1 text-xs">Thu</div>
        <div class="text-center font-semibold text-gray-600 py-1 text-xs">Fri</div>
        <div class="text-center font-semibold text-gray-600 py-1 text-xs">Sat</div>
    </div>
    <div id="client-calendar-grid" class="grid grid-cols-7 gap-1"></div>
</div>
<input type="file" id="client-cal-file-input" multiple accept="image/*,video/*" class="hidden">
{% endblock %}

{% block modals %}
<!-- A. Create Post Modal (split-view) â€” only for SMM / Admin -->
<div id="create-post-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50 p-4" onclick="if(event.target===this) closeCreatePostModal()">
    <div class="bg-white rounded-xl shadow-2xl w-full max-w-5xl max-h-[90vh] overflow-hidden flex flex-col">
        <div class="flex justify-between items-center p-4 border-b">
            <h3 class="text-lg font-bold" id="create-post-title">Create Post</h3>
            <button onclick="closeCreatePostModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
        </div>
        <div class="flex-1 overflow-y-auto">
            <div class="create-post-split">
                <!-- Left: Form -->
                <div class="create-post-form p-4 space-y-3">
                    <input type="hidden" id="cp-edit-id" value="">
                    <div>
                        <label class="block text-xs font-medium text-gray-500 mb-1">Date</label>
                        <input type="date" id="cp-date" class="w-full border rounded-lg px-3 py-2 text-sm">
                    </div>
                    <div>
                        <label class="block text-xs font-medium text-gray-500 mb-1">Platforms</label>
                        <div class="flex flex-wrap gap-2" id="cp-platforms">
                            <label class="platform-toggle" data-platform="instagram">
                                <input type="checkbox" value="instagram" class="hidden" onchange="updateSlidePreview()">
                                <span><i class="fa-brands fa-instagram mr-1"></i>Instagram</span>
                            </label>
                            <label class="platform-toggle" data-platform="facebook">
                                <input type="checkbox" value="facebook" class="hidden" onchange="updateSlidePreview()">
                                <span><i class="fa-brands fa-facebook mr-1"></i>Facebook</span>
                            </label>
                            <label class="platform-toggle" data-platform="linkedin">
                                <input type="checkbox" value="linkedin" class="hidden" onchange="updateSlidePreview()">
                                <span><i class="fa-brands fa-linkedin mr-1"></i>LinkedIn</span>
                            </label>
                            <label class="platform-toggle" data-platform="tiktok">
                                <input type="checkbox" value="tiktok" class="hidden" onchange="updateSlidePreview()">
                                <span><i class="fa-brands fa-tiktok mr-1"></i>TikTok</span>
                            </label>
                            <label class="platform-toggle" data-platform="x">
                                <input type="checkbox" value="x" class="hidden" onchange="updateSlidePreview()">
                                <span><i class="fa-brands fa-x-twitter mr-1"></i>X</span>
                            </label>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-xs font-medium text-gray-500 mb-1">Post Type</label>
                            <select id="cp-post-type" class="w-full border rounded-lg px-3 py-2 text-sm" onchange="updateSlidePreview()">
                                <option value="post">Post</option>
                                <option value="story">Story</option>
                                <option value="reel">Reel</option>
                                <option value="video">Video</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-500 mb-1">Time</label>
                            <input type="time" id="cp-time" class="w-full border rounded-lg px-3 py-2 text-sm" value="12:00">
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs font-medium text-gray-500 mb-1">Tone of Voice / Text on Design</label>
                        <textarea id="cp-tov" class="w-full border rounded-lg px-3 py-2 text-sm" rows="3" placeholder="Write the text that goes on the design..." oninput="updateSlidePreview()"></textarea>
                    </div>
                    <div>
                        <label class="block text-xs font-medium text-gray-500 mb-1">Caption</label>
                        <textarea id="cp-caption" class="w-full border rounded-lg px-3 py-2 text-sm" rows="3" placeholder="Write the post caption..." oninput="updateSlidePreview()"></textarea>
                    </div>
                    <div>
                        <label class="block text-xs font-medium text-gray-500 mb-1">Notes for Designer</label>
                        <textarea id="cp-notes" class="w-full border rounded-lg px-3 py-2 text-sm" rows="2" placeholder="Design instructions, dimensions..." oninput="updateSlidePreview()"></textarea>
                    </div>
                    <div>
                        <label class="block text-xs font-medium text-gray-500 mb-1">Reference Images</label>
                        <input type="file" id="cp-ref-input" multiple accept="image/*" class="hidden" onchange="previewRefImages(this.files)">
                        <div class="upload-zone p-3 rounded-lg text-center cursor-pointer text-sm text-gray-500" onclick="document.getElementById('cp-ref-input').click()">
                            <i class="fa-solid fa-cloud-arrow-up text-xl mb-1 block text-indigo-400"></i>
                            Drop references or click to upload
                        </div>
                        <div id="cp-ref-previews" class="flex flex-wrap gap-2 mt-2"></div>
                    </div>
                </div>
                <!-- Right: Live Slide Preview -->
                <div class="create-post-preview p-4 bg-gray-50">
                    <div class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-3">Live Preview</div>
                    <div id="cp-slide-preview" class="bg-white rounded-xl shadow-sm p-4">
                        <p class="text-gray-400 text-sm text-center py-8">Start typing to see preview...</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="flex justify-end gap-2 p-4 border-t">
            <button onclick="closeCreatePostModal()" class="px-4 py-2 rounded-lg text-sm bg-gray-200 hover:bg-gray-300">Cancel</button>
            <button onclick="submitCreatePost('draft')" class="px-4 py-2 rounded-lg text-sm bg-gray-600 text-white hover:bg-gray-700"><i class="fa-solid fa-save mr-1"></i> Save Draft</button>
            <button onclick="submitCreatePost('in_design')" class="px-4 py-2 rounded-lg text-sm bg-indigo-600 text-white hover:bg-indigo-700"><i class="fa-solid fa-paper-plane mr-1"></i> Send to Designer</button>
        </div>
    </div>
</div>

<!-- B. Post Slide Detail Modal -->
<div id="post-slide-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50 p-4" onclick="if(event.target===this) closePostSlideModal()">
    <div class="bg-white rounded-xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-hidden flex flex-col">
        <div class="flex justify-between items-center p-4 border-b" id="post-slide-header"></div>
        <div class="flex-1 overflow-y-auto p-4" id="post-slide-body"></div>
        <div class="flex flex-wrap gap-2 p-4 border-t" id="post-slide-actions"></div>
    </div>
</div>

<!-- C. Schedule Picker Mini-Modal -->
<div id="schedule-picker-modal" class="fixed inset-0 bg-black bg-opacity-60 hidden flex items-center justify-center z-[60] p-4" onclick="if(event.target===this) closeSchedulePicker()">
    <div class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-sm">
        <h3 class="text-lg font-bold mb-4"><i class="fa-solid fa-calendar-check text-blue-600 mr-2"></i>Schedule Post</h3>
        <input type="hidden" id="sp-post-id">
        <label class="block text-sm font-medium text-gray-600 mb-2">Date & Time</label>
        <input type="datetime-local" id="sp-datetime" class="w-full border rounded-lg px-4 py-3 text-sm mb-4">
        <div class="flex gap-2">
            <button onclick="confirmSchedulePost()" class="flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-blue-700"><i class="fa-solid fa-check mr-1"></i> Schedule</button>
            <button onclick="closeSchedulePicker()" class="flex-1 bg-gray-200 px-4 py-2 rounded-lg text-sm hover:bg-gray-300">Cancel</button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
const clientId = {{ client_id }};
</script>
<script src="/static/js/client-detail.js"></script>
{% endblock %}
