{% extends "base.html" %}
{% block content %}
<div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 mb-4">
    <h2 class="text-xl sm:text-2xl font-bold"><i class="fa-solid fa-calendar-days text-indigo-600 mr-2"></i>Calendar</h2>
    <div class="flex items-center gap-2 w-full sm:w-auto flex-wrap">
        <select id="calendar-client-filter" onchange="loadCalendar()" class="border rounded-lg px-3 py-2 text-sm"><option value="">All Clients</option></select>
        <select id="calendar-status-filter" onchange="applyStatusFilter()" class="border rounded-lg px-3 py-2 text-sm">
            <option value="">All Statuses</option>
            <option value="Needs Design">Needs Design</option>
            <option value="Needs Caption">Needs Caption</option>
            <option value="Design Review">Design Review</option>
            <option value="Ready">Ready</option>
            <option value="Scheduled">Scheduled</option>
            <option value="Posted">Posted</option>
        </select>
        <button onclick="changeMonth(-1)" class="bg-gray-200 px-4 py-2 rounded-lg hover:bg-gray-300"><i class="fa-solid fa-chevron-left"></i></button>
        <span id="calendar-month" class="flex-1 sm:flex-none bg-white px-6 py-2 rounded-lg font-semibold text-center text-sm"></span>
        <button onclick="changeMonth(1)" class="bg-gray-200 px-4 py-2 rounded-lg hover:bg-gray-300"><i class="fa-solid fa-chevron-right"></i></button>
    </div>
</div>

<!-- Status Color Legend -->
<div class="cal-status-legend mb-4 bg-white rounded-lg px-4 py-2 shadow-sm">
    <span class="legend-item"><span class="legend-dot" style="background:#f97316"></span> Needs Design</span>
    <span class="legend-item"><span class="legend-dot" style="background:#eab308"></span> Needs Caption</span>
    <span class="legend-item"><span class="legend-dot" style="background:#8b5cf6"></span> Design Review</span>
    <span class="legend-item"><span class="legend-dot" style="background:#22c55e"></span> Ready</span>
    <span class="legend-item"><span class="legend-dot" style="background:#3b82f6"></span> Scheduled</span>
    <span class="legend-item"><span class="legend-dot" style="background:#10b981"></span> Posted</span>
</div>

<div class="bg-white rounded-xl shadow-sm p-3 sm:p-6 overflow-x-auto">
    <div class="grid grid-cols-7 gap-1 sm:gap-2 mb-2 min-w-[300px]">
        <div class="text-center font-semibold text-gray-600 py-2 text-xs sm:text-sm">Sun</div>
        <div class="text-center font-semibold text-gray-600 py-2 text-xs sm:text-sm">Mon</div>
        <div class="text-center font-semibold text-gray-600 py-2 text-xs sm:text-sm">Tue</div>
        <div class="text-center font-semibold text-gray-600 py-2 text-xs sm:text-sm">Wed</div>
        <div class="text-center font-semibold text-gray-600 py-2 text-xs sm:text-sm">Thu</div>
        <div class="text-center font-semibold text-gray-600 py-2 text-xs sm:text-sm">Fri</div>
        <div class="text-center font-semibold text-gray-600 py-2 text-xs sm:text-sm">Sat</div>
    </div>
    <div id="calendar-grid" class="grid grid-cols-7 gap-1 sm:gap-2 min-w-[300px]"></div>
</div>

<!-- Hidden file input for drag-drop uploads -->
<input type="file" id="cal-file-input" multiple accept="image/*,video/*" class="hidden">
{% endblock %}

{% block modals %}
<!-- Day Posts Modal -->
<div id="day-posts-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50" onclick="if(event.target===this) hideDayPostsModal()">
    <div class="bg-white rounded-xl p-6 w-[95%] sm:w-[600px] max-w-2xl max-h-[80vh] overflow-y-auto shadow-2xl">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-bold" id="day-posts-title">Posts</h3>
            <button onclick="hideDayPostsModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
        </div>
        <div id="day-posts-list" class="space-y-3"></div>
    </div>
</div>

<!-- Post Detail Modal -->
<div id="post-detail-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50" onclick="if(event.target===this) closePostDetail()">
    <div class="bg-white rounded-xl p-6 w-[95%] sm:w-[700px] max-w-3xl max-h-[90vh] overflow-y-auto shadow-2xl">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-bold" id="detail-title">Post Brief</h3>
            <button onclick="closePostDetail()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
        </div>

        <!-- Status & Meta Row -->
        <div class="flex flex-wrap gap-2 mb-4" id="detail-meta"></div>

        <!-- Role-specific banner (populated by JS) -->
        <div id="detail-role-banner" class="hidden"></div>

        <!-- Text on Design (editable in draft) -->
        <div class="brief-section" id="detail-topic-section">
            <div class="brief-section-title"><i class="fa-solid fa-pen-fancy mr-1"></i> Text on Design</div>
            <div class="brief-section-content" id="detail-topic"></div>
            <input type="text" id="detail-topic-input" class="w-full border rounded-lg p-3 text-sm hidden" placeholder="Enter text that goes on the design...">
        </div>

        <!-- Notes for Designer (editable in draft) -->
        <div class="brief-section" id="detail-notes-section">
            <div class="brief-section-title"><i class="fa-solid fa-paintbrush mr-1"></i> Notes for Designer</div>
            <div class="brief-section-content" id="detail-notes"></div>
            <textarea id="detail-notes-input" class="w-full border rounded-lg p-3 text-sm hidden" rows="3" placeholder="Instructions or notes for the designer..."></textarea>
        </div>

        <!-- Design References -->
        <div class="brief-section" id="detail-references-section">
            <div class="brief-section-title"><i class="fa-solid fa-images mr-1"></i> Design References</div>
            <div class="design-gallery mb-2" id="detail-references"></div>
            <div class="upload-zone p-3 rounded-lg text-center cursor-pointer text-sm text-gray-500" id="detail-reference-upload-zone"
                 onclick="document.getElementById('detail-reference-input').click()"
                 ondragover="event.preventDefault(); this.classList.add('dragover')"
                 ondragleave="this.classList.remove('dragover')"
                 ondrop="handleReferenceFileDrop(event)">
                <i class="fa-solid fa-cloud-arrow-up text-xl mb-1 block text-blue-400"></i>
                Drop reference images here or click to upload
            </div>
            <input type="file" id="detail-reference-input" multiple accept="image/*" class="hidden" onchange="uploadReferenceImages(this.files)">
        </div>

        <!-- Design Outputs + Upload Zone -->
        <div class="brief-section" id="detail-designs-section">
            <div class="brief-section-title" id="detail-designs-title"><i class="fa-solid fa-palette mr-1"></i> Design Output</div>
            <div class="design-gallery mb-2" id="detail-designs"></div>
            <div class="upload-zone p-4 rounded-lg text-center cursor-pointer text-sm text-gray-500" id="detail-upload-zone"
                 onclick="document.getElementById('detail-design-input').click()"
                 ondragover="event.preventDefault(); this.classList.add('dragover')"
                 ondragleave="this.classList.remove('dragover')"
                 ondrop="handleDetailDesignDrop(event)">
                <i class="fa-solid fa-cloud-arrow-up text-2xl mb-1 block text-indigo-400"></i>
                Drop designs here or click to upload
            </div>
            <input type="file" id="detail-design-input" multiple accept="image/*" class="hidden" onchange="uploadDetailDesign(this.files)">
        </div>

        <!-- Caption -->
        <div class="brief-section" id="detail-caption-section">
            <div class="brief-section-title"><i class="fa-solid fa-message mr-1"></i> Caption</div>
            <textarea id="detail-caption" class="w-full border rounded-lg p-3 text-sm" rows="4" placeholder="Write caption..."></textarea>
            <div class="flex gap-2 mt-2" id="detail-caption-buttons">
                <button id="btn-save-caption" onclick="saveCaption()" class="bg-indigo-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-indigo-700">
                    <i class="fa-solid fa-save mr-1"></i> Save Caption
                </button>
                <button id="btn-submit-caption" onclick="submitCaption()" class="bg-green-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-green-700 hidden">
                    <i class="fa-solid fa-paper-plane mr-1"></i> Submit Caption & Send to Design
                </button>
            </div>
        </div>

        <!-- Tone of Voice (editable in draft) -->
        <div class="brief-section" id="detail-tov-section">
            <div class="brief-section-title"><i class="fa-solid fa-bullhorn mr-1"></i> Tone of Voice</div>
            <div class="brief-section-content" id="detail-tov"></div>
            <input type="text" id="detail-tov-input" class="w-full border rounded-lg p-3 text-sm hidden" placeholder="e.g. Professional, Playful, Bold...">
        </div>

        <!-- Assignments (editable in draft) -->
        <div class="brief-section" id="detail-assignments-section">
            <div class="brief-section-title"><i class="fa-solid fa-users mr-1"></i> Assignments</div>
            <div class="brief-section-content text-sm" id="detail-assignments"></div>
            <div class="grid grid-cols-2 sm:grid-cols-4 gap-2 hidden" id="detail-assignments-edit">
                <div>
                    <label class="text-xs text-gray-500">Copywriter</label>
                    <select id="detail-writer-select" class="w-full border rounded-lg p-2 text-sm"><option value="">--</option></select>
                </div>
                <div>
                    <label class="text-xs text-gray-500">Designer</label>
                    <select id="detail-designer-select" class="w-full border rounded-lg p-2 text-sm"><option value="">--</option></select>
                </div>
                <div>
                    <label class="text-xs text-gray-500">SM Specialist</label>
                    <select id="detail-sm-select" class="w-full border rounded-lg p-2 text-sm"><option value="">--</option></select>
                </div>
                <div>
                    <label class="text-xs text-gray-500">Motion Editor</label>
                    <select id="detail-motion-select" class="w-full border rounded-lg p-2 text-sm"><option value="">--</option></select>
                </div>
            </div>
        </div>

        <!-- Save Brief Button (for draft editing) -->
        <div class="hidden mt-4" id="detail-save-brief-section">
            <button onclick="saveBriefFromDetail()" class="w-full bg-indigo-600 text-white px-4 py-3 rounded-lg text-sm font-semibold hover:bg-indigo-700">
                <i class="fa-solid fa-save mr-1"></i> Save Brief
            </button>
        </div>

        <!-- Workflow Actions -->
        <div class="flex flex-wrap gap-2 mt-4" id="detail-actions"></div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/js/calendar.js"></script>
{% endblock %}
