{% extends "base.html" %}
{% block content %}
<div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 mb-6">
    <h2 class="text-xl sm:text-2xl font-bold"><i class="fa-solid fa-clipboard-list text-indigo-600 mr-2"></i>Tasks</h2>
    <div class="flex flex-wrap items-center gap-2 w-full sm:w-auto">
        <button onclick="showAddTaskModal()" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 text-sm"><i class="fa-solid fa-plus mr-1"></i> New Task</button>
        <button onclick="taskViewMode='board'; loadTasks()" id="btn-board-view" class="bg-indigo-100 text-indigo-700 px-3 py-2 rounded-lg text-sm font-semibold"><i class="fa-solid fa-columns mr-1"></i> Board</button>
        <button onclick="taskViewMode='list'; loadTasks()" id="btn-list-view" class="bg-gray-100 text-gray-600 px-3 py-2 rounded-lg text-sm"><i class="fa-solid fa-list mr-1"></i> List</button>
        <select id="task-filter-assignee" onchange="loadTasks()" class="border rounded-lg px-3 py-2 text-sm"><option value="">All Members</option></select>
        <select id="task-filter-client" onchange="loadTasks()" class="border rounded-lg px-3 py-2 text-sm"><option value="">All Clients</option></select>
        <select id="task-filter-priority" onchange="loadTasks()" class="border rounded-lg px-3 py-2 text-sm">
            <option value="">All Priorities</option>
            <option value="urgent">Urgent</option>
            <option value="high">High</option>
            <option value="normal">Normal</option>
            <option value="low">Low</option>
        </select>
    </div>
</div>
<div id="tasks-board-view">
    <div class="kanban-board" id="kanban-board">
        <div class="kanban-column">
            <div class="kanban-column-header"><span><i class="fa-solid fa-circle-dot text-gray-400 mr-2"></i>To Do</span><span class="text-xs bg-gray-200 px-2 py-1 rounded-full" id="count-todo">0</span></div>
            <div class="kanban-cards" id="col-todo" data-status="todo"></div>
        </div>
        <div class="kanban-column">
            <div class="kanban-column-header"><span><i class="fa-solid fa-spinner text-blue-500 mr-2"></i>In Progress</span><span class="text-xs bg-blue-200 px-2 py-1 rounded-full" id="count-in_progress">0</span></div>
            <div class="kanban-cards" id="col-in_progress" data-status="in_progress"></div>
        </div>
        <div class="kanban-column">
            <div class="kanban-column-header"><span><i class="fa-solid fa-magnifying-glass text-yellow-500 mr-2"></i>In Review</span><span class="text-xs bg-yellow-200 px-2 py-1 rounded-full" id="count-in_review">0</span></div>
            <div class="kanban-cards" id="col-in_review" data-status="in_review"></div>
        </div>
        <div class="kanban-column">
            <div class="kanban-column-header"><span><i class="fa-solid fa-circle-check text-green-500 mr-2"></i>Done</span><span class="text-xs bg-green-200 px-2 py-1 rounded-full" id="count-done">0</span></div>
            <div class="kanban-cards" id="col-done" data-status="done"></div>
        </div>
    </div>
</div>
<div id="tasks-list-view" class="hidden">
    <div class="bg-white rounded-xl shadow-sm overflow-x-auto">
        <table class="w-full min-w-[700px]">
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600">Task</th>
                    <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600">Client</th>
                    <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600">Assignee</th>
                    <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600">Priority</th>
                    <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600">Due Date</th>
                    <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600">Status</th>
                    <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600">Actions</th>
                </tr>
            </thead>
            <tbody id="tasks-table-body"></tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block modals %}
<!-- Add Task Modal -->
<div id="add-task-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50 p-4" onclick="if(event.target===this) hideAddTaskModal()">
    <div class="bg-white rounded-xl p-6 w-full sm:w-[550px] max-w-2xl max-h-[90vh] overflow-y-auto shadow-2xl">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-bold">New Task</h3>
            <button onclick="hideAddTaskModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
        </div>
        <div class="space-y-4">
            <div><label class="block text-gray-700 font-medium mb-1 text-sm">Task Title *</label><input type="text" id="task-title" class="w-full border rounded-lg px-4 py-2" placeholder="e.g. Design Q1 campaign ad"></div>
            <div><label class="block text-gray-700 font-medium mb-1 text-sm">Description</label><textarea id="task-description" class="w-full border rounded-lg px-4 py-2 h-24 resize-none" placeholder="Task details..."></textarea></div>
            <div class="grid grid-cols-2 gap-4">
                <div><label class="block text-gray-700 font-medium mb-1 text-sm">Client</label><select id="task-client" class="w-full border rounded-lg px-4 py-2"><option value="">No client</option></select></div>
                <div><label class="block text-gray-700 font-medium mb-1 text-sm">Assign To</label><select id="task-assignee" class="w-full border rounded-lg px-4 py-2"><option value="">Unassigned</option></select></div>
            </div>
            <div class="grid grid-cols-3 gap-4">
                <div><label class="block text-gray-700 font-medium mb-1 text-sm">Priority</label>
                    <select id="task-priority" class="w-full border rounded-lg px-4 py-2"><option value="normal">Normal</option><option value="urgent">Urgent</option><option value="high">High</option><option value="low">Low</option></select>
                </div>
                <div><label class="block text-gray-700 font-medium mb-1 text-sm">Category</label>
                    <select id="task-category" class="w-full border rounded-lg px-4 py-2"><option value="general">General</option><option value="design">Design</option><option value="content">Content</option><option value="development">Development</option><option value="admin">Admin</option></select>
                </div>
                <div><label class="block text-gray-700 font-medium mb-1 text-sm">Due Date</label><input type="date" id="task-due-date" class="w-full border rounded-lg px-4 py-2"></div>
            </div>
            <div class="flex gap-4 pt-2">
                <button onclick="submitTask()" class="flex-1 bg-indigo-600 text-white px-4 py-3 rounded-lg hover:bg-indigo-700 font-semibold">Create Task</button>
                <button onclick="hideAddTaskModal()" class="flex-1 bg-gray-200 px-4 py-3 rounded-lg hover:bg-gray-300">Cancel</button>
            </div>
        </div>
    </div>
</div>
<!-- Task Detail Modal -->
<div id="task-detail-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50 p-4" onclick="if(event.target===this) hideTaskDetailModal()">
    <div class="bg-white rounded-xl p-6 w-full sm:w-[650px] max-w-3xl max-h-[90vh] overflow-y-auto shadow-2xl">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-bold" id="task-detail-title">Task Details</h3>
            <button onclick="hideTaskDetailModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
        </div>
        <div id="task-detail-content"></div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/js/tasks.js"></script>
{% endblock %}
