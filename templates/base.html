<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Eclipse Agency{% endblock %}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/dashboard.css">
    {% block head %}{% endblock %}
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- Mobile Header -->
    <div class="lg:hidden fixed top-0 left-0 right-0 bg-white z-40 px-4 py-3 flex items-center justify-between mobile-top-bar">
        <h1 class="text-gray-800 font-bold text-base tracking-tight">Eclipse</h1>
        <div class="flex items-center gap-3">
            <a href="/notifications" class="text-gray-500 text-lg relative"><i class="fa-solid fa-bell"></i><span id="mobile-notif-dot" class="hidden" style="position:absolute;top:-2px;right:-2px;width:8px;height:8px;background:#ef4444;border-radius:50%;"></span></a>
            <button onclick="toggleDarkMode()" class="text-gray-500 text-lg"><i class="fa-solid fa-moon"></i></button>
        </div>
    </div>

    <!-- Mobile Overlay -->
    <div id="mobile-overlay" class="lg:hidden fixed inset-0 bg-black bg-opacity-50 z-40 hidden" onclick="toggleMobileMenu()"></div>

    <div class="flex">
        <!-- Sidebar -->
        <aside id="sidebar" class="w-64 bg-[#0f172a] min-h-screen p-6 fixed left-0 z-50 transition-transform duration-300 transform lg:translate-x-0 -translate-x-full">
            <!-- Mobile close button -->
            <div class="lg:hidden flex justify-between items-center mb-4">
                <h1 class="text-white text-lg font-bold">Eclipse Agency</h1>
                <button onclick="toggleMobileMenu()" class="text-white text-2xl">&times;</button>
            </div>

            <!-- Desktop logo -->
            <div class="hidden lg:block mb-6">
                <h1 class="text-white text-xl font-bold tracking-tight">Eclipse Agency</h1>
                <p class="text-slate-500 text-xs mt-1">Marketing Team Platform</p>
            </div>

            <!-- User greeting -->
            <p class="text-slate-400 text-sm">Hello, <span id="user-name" class="text-white font-medium">User</span></p>
            <p id="user-job-title" class="text-slate-500 text-xs hidden"></p>
            <span id="user-role-badge" class="inline-block text-[10px] font-semibold uppercase tracking-wider px-2 py-0.5 rounded-full mt-1 mb-4"></span>

            <!-- Main Navigation — Workflow steps -->
            <p class="text-slate-500 text-[10px] font-semibold uppercase tracking-wider px-3 mb-1">Workflow</p>
            <nav class="space-y-1">
                <a href="/clients" data-nav-perm="viewClients"
                   class="sidebar-link {% if active_page == 'clients' %}active{% endif %}">
                    <i class="fa-solid fa-building w-5 text-center"></i> Accounts
                </a>
                <a href="/"
                   class="sidebar-link {% if active_page == 'overview' %}active{% endif %}">
                    <i class="fa-solid fa-clipboard-check w-5 text-center"></i> My Tasks
                </a>
                <a href="/notifications"
                   class="sidebar-link relative {% if active_page == 'notifications' %}active{% endif %}">
                    <i class="fa-solid fa-bell w-5 text-center"></i> Notifications <span id="sidebar-notif-badge" class="notif-badge hidden">0</span>
                </a>
            </nav>

            <!-- Admin section — collapsible -->
            <div class="mt-4">
                <button onclick="document.getElementById('sidebar-more').classList.toggle('hidden')" class="flex items-center justify-between w-full text-slate-500 text-[10px] font-semibold uppercase tracking-wider px-3 py-2 hover:text-slate-300 transition">
                    <span>Admin</span>
                    <i class="fa-solid fa-chevron-down text-[10px]"></i>
                </button>
                <div id="sidebar-more" class="space-y-1 hidden">
                    <a href="/team" id="users-nav" data-nav-perm="manageTeam"
                       class="sidebar-link {% if active_page == 'team' %}active{% endif %}">
                        <i class="fa-solid fa-user-gear w-5 text-center"></i> Team
                    </a>
                    <a href="/analytics" data-nav-perm="viewAll"
                       class="sidebar-link {% if active_page == 'analytics' %}active{% endif %}">
                        <i class="fa-solid fa-chart-bar w-5 text-center"></i> Analytics
                    </a>
                    <a href="/settings"
                       class="sidebar-link {% if active_page == 'settings' %}active{% endif %}">
                        <i class="fa-solid fa-gear w-5 text-center"></i> Settings
                    </a>
                </div>
            </div>

            <!-- Bottom buttons -->
            <div class="mt-6 space-y-2 lg:absolute lg:bottom-6 lg:left-6 lg:right-6">
                <button onclick="toggleDarkMode()" class="w-full bg-slate-800 text-slate-300 py-2 rounded-lg hover:bg-slate-700 text-sm transition"><i class="fa-solid fa-moon mr-2"></i>Dark Mode</button>
                <button onclick="logout()" class="w-full bg-red-900/30 text-red-400 py-2 rounded-lg hover:bg-red-900/50 text-sm transition"><i class="fa-solid fa-right-from-bracket mr-2"></i>Sign Out</button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 p-4 lg:p-8 lg:ml-64 mt-14 lg:mt-0 pb-20 lg:pb-8">
            {% block content %}{% endblock %}
        </main>
    </div>

    <!-- Modals -->
    {% block modals %}{% endblock %}

    <!-- Mobile Bottom Nav Bar -->
    <nav class="bottom-nav">
        <a href="/clients" class="bottom-nav-item {% if active_page == 'clients' %}active{% endif %}" data-nav-perm="viewClients">
            <div class="bottom-nav-icon">
                <i class="fa-solid fa-building"></i>
            </div>
            <span>Accounts</span>
        </a>
        <a href="/" class="bottom-nav-item {% if active_page == 'overview' %}active{% endif %}">
            <div class="bottom-nav-icon">
                <i class="fa-solid fa-clipboard-check"></i>
            </div>
            <span>Tasks</span>
        </a>
        <a href="/notifications" class="bottom-nav-item {% if active_page == 'notifications' %}active{% endif %}">
            <div class="bottom-nav-icon">
                <i class="fa-solid fa-bell"></i>
            </div>
            <span>Alerts</span>
        </a>
    </nav>

    <!-- Toast Container -->
    <div id="toast-container" class="fixed bottom-20 lg:bottom-4 right-4 z-50 flex flex-col gap-2"></div>

    <!-- Scripts -->
    <script src="/static/js/common.js"></script>
    {% block scripts %}{% endblock %}
</body>
</html>
